# *******************************************************************************
# Copyright (c) 2025 Contributors to the Eclipse Foundation
#
# See the NOTICE file(s) distributed with this work for additional
# information regarding copyright ownership.
#
# This program and the accompanying materials are made available under the
# terms of the Apache License Version 2.0 which is available at
# https://www.apache.org/licenses/LICENSE-2.0
#
# SPDX-License-Identifier: Apache-2.0
# *******************************************************************************

"""
Integration Tests
"""

load("@bazel_tools_python//quality:defs.bzl", "py_pytest")
load("@score_itf//:defs.bzl", "py_itf_test")

py_pytest(
    name = "integration",
    size = "medium",
    srcs = glob(
        ["test_*.py"],
        exclude = ["test_qemu_*.py", "test_ssh.py"],
        allow_empty = True,
    ) + ["conftest.py"],
    data = ["vsomeip-local.json"],
    # Restrict the test execution to Linux for the moment due to dependency on Python
    target_compatible_with = ["@platforms//os:linux"],
    deps = [
        "//src/someipd",
        "@someip_pip//pytest",
        "@someip_pip//someip",
    ],
    target_compatible_with = ["@platforms//os:linux"],
)

# ---------------------------------------------------------------------------
# SSH connectivity test for QNX QEMU image
# Requires QEMU to be running: bazel run //deployment/qemu:run_qemu --config=x86_64-qnx
# Then run: bazel test //tests/integration:test_ssh --test_output=all
# ---------------------------------------------------------------------------
py_itf_test(
    name = "test_ssh",
    srcs = [
        "conftest.py",
        "test_ssh.py",
    ],
)
